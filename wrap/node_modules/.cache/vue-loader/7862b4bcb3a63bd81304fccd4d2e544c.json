{"remainingRequest":"D:\\code\\code2\\sh_19_0722\\code-work\\layout\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\code2\\sh_19_0722\\code-work\\layout\\src\\pages\\ele-goods\\ele-goods.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\code2\\sh_19_0722\\code-work\\layout\\src\\pages\\ele-goods\\ele-goods.vue","mtime":1576545357529},{"path":"D:\\code\\code2\\sh_19_0722\\code-work\\layout\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code\\code2\\sh_19_0722\\code-work\\layout\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\code\\code2\\sh_19_0722\\code-work\\layout\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code\\code2\\sh_19_0722\\code-work\\layout\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBCU2Nyb2xsIGZyb20gJ2JldHRlci1zY3JvbGwnCmltcG9ydCBpY29uIGZyb20gImNvbXBvbmVudHMvZWxlLWljb24vZWxlLWljb24iCmltcG9ydCBjb250cm9sIGZyb20gImNvbXBvbmVudHMvZWxlLWNvbnRyb2wvZWxlLWNvbnRvcmwiCmltcG9ydCBjYXJ0IGZyb20gImNvbXBvbmVudHMvZWxlLWNhcnQvZWxlLWNhcnQudnVlIgpjb25zdCBPSyA9IDA7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJlbGUtZ29vZHMiLAogICAgcHJvcHM6ewogICAgICAgIHNlbGxlcjpPYmplY3QKICAgIH0sCiAgICBkYXRhKCl7CiAgICAgIHJldHVybnsKICAgICAgICAgIGdvb2RzOltdLAogICAgICAgICAgc2Nyb2xsWTowLAogICAgICAgICAgdG9wczpbXQogICAgICB9CiAgICB9LAogICAgY29tcHV0ZWQ6ewogICAgICAgIHNlbGVjdGVkRm9vZHMoKXsKICAgICAgICAgIGxldCBzZWxlY3RlZEZvb2RzID0gW107CiAgICAgICAgICB0aGlzLmdvb2RzLmZvckVhY2goKGdvb2QpPT57CiAgICAgICAgICAgICAgZ29vZC5mb29kcy5mb3JFYWNoKChmb29kKT0+ewogICAgICAgICAgICAgICAgICBpZihmb29kLmNvdW50ID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZvb2RzLnB1c2goZm9vZCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRm9vZHM7CiAgICAgICAgfSwKICAgICAgICBjdXJyZW50SW5kZXgoKXsKICAgICAgICAgICAgLy/kvp3otZbkuo7lj7PkvqfliJfooajnmoTmu5HliqjkvY3nva4KICAgICAgICAgICAgbGV0IHt0b3BzLHNjcm9sbFl9ID0gdGhpczsKICAgICAgICAgICAgbGV0IGluZGV4ID10b3BzLmZpbmRJbmRleCgodG9wLGluZGV4KT0+ewogICAgICAgICAgICAgICAgcmV0dXJuIHNjcm9sbFkgPj10b3AgJiYgc2Nyb2xsWSA8IHRvcHNbaW5kZXgrMV0KICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC8v5bem5L6n5YiX6KGo5Yiw572u6aG2CiAgICAgICAgICAgIGlmKGluZGV4ICE9PSB0aGlzLm9sZGluZGV4KXsKICAgICAgICAgICAgICAgIHRoaXMub2xkaW5kZXggPSBpbmRleDsKICAgICAgICAgICAgICAgIHZhciBsaU5vZGUgPSB0aGlzLiRyZWZzLm1lbnVMaXN0LmNoaWxkcmVuW2luZGV4XTsKICAgICAgICAgICAgICAgIHRoaXMubWVudVNjcm9sbC5zY3JvbGxUb0VsZW1lbnQobGlOb2RlLDMwMCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaW5kZXgKICAgICAgICB9CiAgICB9LAogICAgY29tcG9uZW50czp7CiAgICAgICAgImVsZS1pY29uIjppY29uLAogICAgICAgICJlbGUtY29udHJvbCI6Y29udHJvbCwKICAgICAgICAiZWxlLWNhcnQiOmNhcnQKICAgIH0sCiAgICBtZXRob2RzOnsKICAgICAgICBhZGRDb3VudChnb29kSW5kZXgsZm9vZEluZGV4KXsKICAgICAgICAgICAgbGV0IGZvb2QgPSB0aGlzLmdvb2RzLmZpbmQoIChnb29kLGluZGV4KT0+IGluZGV4ID09PSBnb29kSW5kZXggKQogICAgICAgICAgICAgICAgLmZvb2RzLmZpbmQoKGZvb2QsaW5kZXgpID0+IGluZGV4ID09PSAgZm9vZEluZGV4KTsKCiAgICAgICAgICAgIGlmKCFmb29kLmNvdW50KXsKICAgICAgICAgICAgICAgIHRoaXMuJHNldChmb29kLCJjb3VudCIsMSkKICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgZm9vZC5jb3VudCsrCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZUNvdW50KGdvb2RJbmRleCxmb29kSW5kZXgpewogICAgICAgICAgICBsZXQgZm9vZCA9IHRoaXMuZ29vZHMuZmluZCggKGdvb2QsaW5kZXgpPT4gaW5kZXggPT09IGdvb2RJbmRleCApCiAgICAgICAgICAgICAgICAuZm9vZHMuZmluZCgoZm9vZCxpbmRleCkgPT4gaW5kZXggPT09ICBmb29kSW5kZXgpOwogICAgICAgICAgICBpZihmb29kLmNvdW50ID4gMCl7CiAgICAgICAgICAgICAgICBmb29kLmNvdW50LS0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaGFuZGxlQ0Zvck1lbnVMaXN0KGluZGV4KXsKICAgICAgICAgICAgY29uc3QgdG9wID0gdGhpcy50b3BzW2luZGV4XTsKICAgICAgICAgICAgdGhpcy5mb29kc1Njcm9sbC5zY3JvbGxUbygwLC10b3AsMzAwKQogICAgICAgIH0sCiAgICAgICAgX2luaXRTY3JvbGwoKXsKICAgICAgICAgICAgdGhpcy5tZW51U2Nyb2xsID0gbmV3IEJTY3JvbGwodGhpcy4kcmVmcy5tZW51V3JhcCx7CiAgICAgICAgICAgICAgICBjbGljazp0cnVlCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuZm9vZHNTY3JvbGwgPSBuZXcgQlNjcm9sbCh0aGlzLiRyZWZzLmZvb2RzV3JhcCx7CiAgICAgICAgICAgICAgICBjbGljazp0cnVlLAogICAgICAgICAgICAgICAgcHJvYmVUeXBlOjMKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdGhpcy5mb29kc1Njcm9sbC5vbigic2Nyb2xsIiwoe3gseX0pPT57CiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFkgPSBNYXRoLmFicyh5KQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgX2luaXRUb3BzKCl7CiAgICAgICAgICAgIGxldCBsaU5vZGVzID0gdGhpcy4kcmVmcy5mb29kc0xpc3QuY2hpbGRyZW47CiAgICAgICAgICAgIGxldCB0b3AgPSAwOwogICAgICAgICAgICBsZXQgdG9wcyA9IFt0b3BdOwogICAgICAgICAgICBBcnJheS5mcm9tKGxpTm9kZXMpLmZvckVhY2goKGxpTm9kZSk9PnsKICAgICAgICAgICAgICAgIHRvcCArPSBsaU5vZGUub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgdG9wcy5wdXNoKHRvcCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdGhpcy50b3BzID0gdG9wczsKICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgbW91bnRlZCgpewogICAgICAgIGNvbnN0ICB7ZXJybm8sYm9keX0gPSBhd2FpdCB0aGlzLiRodHRwLmdvb2RzLmdldEdvb2RzKCkKICAgICAgICBpZihlcnJubyA9PT0gT0spewogICAgICAgICAgICB0aGlzLmdvb2RzID0gYm9keQogICAgICAgIH0KICAgICAgICAvL+a7keWxjwogICAgICAgIHRoaXMuX2luaXRTY3JvbGwoKTsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKT0+ewogICAgICAgICAgICB0aGlzLl9pbml0VG9wcygpCiAgICAgICAgfSkKICAgIH0KfQo="},{"version":3,"sources":["ele-goods.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ele-goods.vue","sourceRoot":"src/pages/ele-goods","sourcesContent":["<template>\r\n    <div class=\"goods\">\r\n        <div class=\"menu-wrap\" ref=\"menuWrap\">\r\n            <ul class=\"menu-list\" ref=\"menuList\">\r\n                <li v-for=\"(good,index) in goods\" class=\"menu-item\"\r\n                    :class=\"{active:currentIndex === index}\" @click=\"handleCForMenuList(index)\">\r\n                    <ele-icon class=\"icon\" :size=\"3\" :type=\"good.type\" v-show=\"good.type >= 0\"></ele-icon>\r\n                    <span class=\"text\">{{good.name}}</span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class=\"foods-wrap\" ref=\"foodsWrap\">\r\n            <ul class=\"foods-list\" ref=\"foodsList\">\r\n                <li class=\"foods-item\" v-for=\"(good,goodIndex) in goods\">\r\n                    <h2 class=\"title\">{{good.name}}</h2>\r\n                    <ul class=\"food-list\">\r\n                        <li class=\"food-item\" v-for=\"(food,foodIndex) in good.foods\" >\r\n                            <div class=\"left\">\r\n                                <img :src=\"food.icon\">\r\n                            </div>\r\n                            <div class=\"right\">\r\n                                <div class=\"name\">{{food.name}}</div>\r\n                                <div class=\"description\">{{food.description}}</div>\r\n                                <div class=\"others\">\r\n                                    <span class=\"sellCount\">月售{{food.sellCount}}份</span>\r\n                                    <span class=\"rating\">好评率{{food.rating}}%</span>\r\n                                </div>\r\n                                <div class=\"prices\">\r\n                                    <span class=\"nowPrice\">¥{{food.price}}</span>\r\n                                    <span class=\"oldPrice\" v-show=\"food.oldPrice\">¥{{food.oldPrice}}</span>\r\n                                </div>\r\n                                <ele-control :food=\"food\" class=\"control\"\r\n                                    @addCount=\"addCount\"  @removeCount=\"removeCount\"\r\n                                    :goodIndex=\"goodIndex\" :foodIndex=\"foodIndex\"></ele-control>\r\n                            </div>\r\n                        </li>\r\n                    </ul>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <ele-cart :deliveryPrice=\"seller.deliveryPrice\" :minPrice=\"seller.minPrice\"\r\n                  :selectedFoods=\"selectedFoods\"></ele-cart>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import BScroll from 'better-scroll'\r\n    import icon from \"components/ele-icon/ele-icon\"\r\n    import control from \"components/ele-control/ele-contorl\"\r\n    import cart from \"components/ele-cart/ele-cart.vue\"\r\n    const OK = 0;\r\n    export default {\r\n        name: \"ele-goods\",\r\n        props:{\r\n            seller:Object\r\n        },\r\n        data(){\r\n          return{\r\n              goods:[],\r\n              scrollY:0,\r\n              tops:[]\r\n          }\r\n        },\r\n        computed:{\r\n            selectedFoods(){\r\n              let selectedFoods = [];\r\n              this.goods.forEach((good)=>{\r\n                  good.foods.forEach((food)=>{\r\n                      if(food.count > 0){\r\n                          selectedFoods.push(food)\r\n                      }\r\n                  })\r\n              })\r\n              return selectedFoods;\r\n            },\r\n            currentIndex(){\r\n                //依赖于右侧列表的滑动位置\r\n                let {tops,scrollY} = this;\r\n                let index =tops.findIndex((top,index)=>{\r\n                    return scrollY >=top && scrollY < tops[index+1]\r\n                })\r\n\r\n                //左侧列表到置顶\r\n                if(index !== this.oldindex){\r\n                    this.oldindex = index;\r\n                    var liNode = this.$refs.menuList.children[index];\r\n                    this.menuScroll.scrollToElement(liNode,300)\r\n                }\r\n                return index\r\n            }\r\n        },\r\n        components:{\r\n            \"ele-icon\":icon,\r\n            \"ele-control\":control,\r\n            \"ele-cart\":cart\r\n        },\r\n        methods:{\r\n            addCount(goodIndex,foodIndex){\r\n                let food = this.goods.find( (good,index)=> index === goodIndex )\r\n                    .foods.find((food,index) => index ===  foodIndex);\r\n\r\n                if(!food.count){\r\n                    this.$set(food,\"count\",1)\r\n                }else {\r\n                    food.count++\r\n                }\r\n            },\r\n            removeCount(goodIndex,foodIndex){\r\n                let food = this.goods.find( (good,index)=> index === goodIndex )\r\n                    .foods.find((food,index) => index ===  foodIndex);\r\n                if(food.count > 0){\r\n                    food.count--\r\n                }\r\n            },\r\n            handleCForMenuList(index){\r\n                const top = this.tops[index];\r\n                this.foodsScroll.scrollTo(0,-top,300)\r\n            },\r\n            _initScroll(){\r\n                this.menuScroll = new BScroll(this.$refs.menuWrap,{\r\n                    click:true\r\n                })\r\n                this.foodsScroll = new BScroll(this.$refs.foodsWrap,{\r\n                    click:true,\r\n                    probeType:3\r\n                })\r\n                this.foodsScroll.on(\"scroll\",({x,y})=>{\r\n                    this.scrollY = Math.abs(y)\r\n                })\r\n            },\r\n            _initTops(){\r\n                let liNodes = this.$refs.foodsList.children;\r\n                let top = 0;\r\n                let tops = [top];\r\n                Array.from(liNodes).forEach((liNode)=>{\r\n                    top += liNode.offsetHeight;\r\n                    tops.push(top)\r\n                })\r\n                this.tops = tops;\r\n            }\r\n        },\r\n        async mounted(){\r\n            const  {errno,body} = await this.$http.goods.getGoods()\r\n            if(errno === OK){\r\n                this.goods = body\r\n            }\r\n            //滑屏\r\n            this._initScroll();\r\n            this.$nextTick(()=>{\r\n                this._initTops()\r\n            })\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped lang=\"stylus\">\r\n    @import \"../../common/stylus/mixin.styl\"\r\n    .goods\r\n        display flex\r\n        position absolute\r\n        left 0\r\n        right 0\r\n        top 174px\r\n        bottom 48px\r\n        overflow hidden\r\n        .menu-wrap\r\n            flex 0 0 80px\r\n            .menu-list\r\n                .menu-item\r\n                    one-px(rgba(7,17,27,0.1))\r\n                    display flex\r\n                    align-items center\r\n                    justify-content center\r\n                    width 100%\r\n                    height 54px\r\n                    background #f3f5f7\r\n                    &::after\r\n                        width 56px\r\n                    &.active\r\n                        background pink\r\n                    .icon\r\n                        margin-right 2px\r\n                    .text\r\n                        font-size 12px\r\n                        line-height 14px\r\n                        color rgba(7,17,27,1)\r\n        .foods-wrap\r\n            flex 1\r\n            .foods-list\r\n                .foods-item\r\n                    .title\r\n                        height 26px\r\n                        background #f3f5f7\r\n                        font-size 12px\r\n                        line-height 26px\r\n                        color rgba(147,153,159,1)\r\n                        border-left 4px solid #d9dde1\r\n                        padding-left 14px\r\n                    .food-list\r\n                        .food-item\r\n                            position relative\r\n                            one-px(rgba(7,17,27,0.3))\r\n                            padding 18px\r\n                            display flex\r\n                            &::after\r\n                                width 88%\r\n                            &:last-child\r\n                                 border-none()\r\n                            .left\r\n                                flex 0 0 80px\r\n                                margin-right 10px\r\n                                img\r\n                                    width 100%\r\n                                    height 93%\r\n                            .right\r\n                                flex 1\r\n                                .name\r\n                                    font-size 14px\r\n                                    line-height 14px\r\n                                    color rgba(7,17,27,1)\r\n                                    margin-top 2px\r\n                                    margin-bottom 8px\r\n                                .description\r\n                                    font-size 10px\r\n                                    line-height 10px\r\n                                    color rgba(147,153,159,1)\r\n                                .others\r\n                                    font-size 14px\r\n                                    line-height 14px\r\n                                    color rgba(147,153,159,1)\r\n                                    margin-top 8px\r\n                                    margin-bottom 8px\r\n                                .prices\r\n                                    .nowPrice\r\n                                        margin-right 8px\r\n                                        font-size 14px\r\n                                        color rgba(240,20,20,1)\r\n                                        line-height 24px\r\n                                        font-weight 700\r\n                                    .oldPrice\r\n                                        font-size 10px\r\n                                        color rgba(240,20,20,1)\r\n                                        line-height 24px\r\n                                        font-weight 700\r\n                                        text-decoration line-through\r\n\r\n                                .control\r\n                                    position absolute\r\n                                    right 18px\r\n                                    bottom 18px\r\n</style>"]}]}